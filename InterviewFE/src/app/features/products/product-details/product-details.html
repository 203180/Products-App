<div class="rounded-4 bg-gradient border border-1 border-silver h-100">

  <app-upsert-product-modal
    [visible]="upsertVisible"
    [product]="product"
    (closed)="closeEdit()"
    (saved)="onSaved()"
  ></app-upsert-product-modal>

  <app-confirmation-modal
    [visible]="confirmationModalVisible"
    [title]="confirmationModalTitle"
    [subtitle]="confirmationModalSubTitle"
    [danger]="true"
    confirmText="Delete"
    (confirm)="confirmDelete()"
    (dismiss)="closeDeleteConfirm()"
  ></app-confirmation-modal>

  @if (product) {
    <div class="p-4 border-bottom d-flex justify-content-between align-items-center">
      <button routerLink="/products" class="btn btn-outline-light">
        <i class="fa-solid fa-arrow-left me-2"></i>
        Back To Products
      </button>

      @if (product.quantityInStock > 0) {
        <span class="badge rounded-pill text-bg-success p-2">
          In Stock
        </span>
      } @else if (product.quantityInStock === 0) {
        <span class="badge rounded-pill text-bg-danger p-2">
          Out Of Stock
        </span>
      }
    </div>

    <div class="p-4">
      <div class="row g-4 align-items-start">

        <div class="col-12 col-lg-4">
          <div class="ratio ratio-1x1 rounded-4 overflow-hidden border border-1 border-silver shadow-sm bg-dark">
            @if (product?.imageBase64) {
              <img
                [src]="'data:image/jpeg;base64,' + product.imageBase64"
                class="img-fluid rounded mt-3"
              />
            }
            @else {
              <div class="h-100 w-100 d-flex flex-column align-items-center justify-content-center gap-3">
                <div
                  class="rounded-circle bg-dark bg-opacity-25 border border-light d-flex align-items-center justify-content-center"
                  style="width:90px; height:90px;">
                  <i class="fa-solid fa-image fs-2 text-light"></i>
                </div>
                <h2 class="text-light">No Image Provided</h2>
              </div>
            }
          </div>


          <div class="d-flex gap-2 mt-3">
          <span class="badge rounded-pill text-bg-dark border border-1 border-silver">
            ID: {{ product.id }}
          </span>
            <span class="badge rounded-pill text-bg-dark border border-1 border-silver">
            Category: {{ categoryLabel || '—' }}
          </span>
          </div>
        </div>


        <div class="col-12 col-lg-8">
          <div class="d-flex flex-column gap-3">

            <div class="d-flex w-100 justify-content-between align-items-start">
              <div>
                <h1 class="text-white fw-bold mb-1">{{ product.name }}</h1>
                <div class="text-white-50">
                  {{ categoryLabel }}
                </div>
              </div>
              <div>
                <button class="btn btn-sm fw-bold btn-primary me-2" (click)="openEdit()">
                  <i class="fa-solid fa-pen me-1"></i>
                  Edit
                </button>
                <button class="btn btn-sm fw-bold btn-danger" (click)="openDeleteConfirm()">
                  <i class="fa-solid fa-trash me-1"></i>
                  Delete
                </button>
              </div>
            </div>

            <div class="row g-3">
              <div class="col-12 col-md-6">
                <div class="p-3 rounded-4 border border-1 border-silver bg-dark bg-opacity-25">
                  <div class="text-white-50 small">Price</div>
                  <div class="text-white fs-4 fw-bold">
                    {{ product.price }}
                  </div>
                </div>
              </div>
              <div class="col-12 col-md-6">
                <div class="p-3 rounded-4 border border-1 border-silver bg-dark bg-opacity-25">
                  <div class="text-white-50 small">Quantity in stock</div>
                  <div class="text-white fs-4 fw-bold">
                    {{ product.quantityInStock }}
                  </div>
                </div>
              </div>
            </div>

            <div class="rounded-4 border border-1 border-silver align-top">
              <table class="table table-dark table-striped mb-0 align-middle">
                <tbody>
                  @if (product.category) {
                    <tr>
                      <td class="text-white-50 w-25">Category</td>
                      <td class="fw-semibold">{{ categoryLabel || '—' }}</td>
                    </tr>
                  }
                <tr>
                  <td class="text-white-50">Price</td>
                  <td class="fw-semibold">{{ product.price }}</td>
                </tr>
                <tr>
                  <td class="text-white-50">Quantity</td>
                  <td class="fw-semibold">{{ product.quantityInStock }}</td>
                </tr>
                  @if (product.description) {
                    <tr>
                      <td class="text-white-50">Description</td>
                      <td class="fw-semibold">{{ product.description || '—' }}</td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  } @else if (!isLoading){
    <div class="h-100 d-flex flex-column align-items-center justify-content-center">

      <div
        class="rounded-circle bg-dark bg-opacity-25 border border-light d-flex align-items-center justify-content-center mb-4"
        style="width:90px; height:90px;">
        <i class="fa-solid fa-box-open fs-2 text-light"></i>
      </div>

      <h2 class="fw-bold mb-2 text-light">
        Product Not Found
      </h2>

      <p class="text-white-50 mb-4 w-75 text-center">
        The product you are looking for does not exist or may have been removed.
        Please check the URL or return to the products list.
      </p>

      <a routerLink="/products" class="btn btn-outline-light px-4">
        <i class="fa-solid fa-arrow-left me-2"></i>
        Back To Products
      </a>

    </div>
  }
</div>
